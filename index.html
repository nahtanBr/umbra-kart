<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RoadFury</title>
<style>
  :root{
    --bg:#7f1d1d; --bg2:#000;
    --card:rgba(255,255,255,.06); --border:rgba(255,255,255,.15);
    --txt:#e5e7eb; --muted:#cbd5e1; --rad:14px; --pad:12px; --gap:12px; --gap-sm:8px;
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;font-family:ui-sans-serif,system-ui,Segoe UI,Roboto; color:var(--txt);
       background:linear-gradient(to bottom,var(--bg),var(--bg2))}
  .container{max-width:1200px;margin:0 auto;padding:var(--pad);display:grid;gap:var(--gap)}
  header{display:flex;align-items:center;justify-content:space-between;gap:var(--gap)}
  .space{display:flex;justify-content:space-between;align-items:center;gap:var(--gap-sm)}
  .flex{display:flex;gap:var(--gap-sm);align-items:center}
  .grid{display:grid;gap:var(--gap-sm)}
  .grid-2{display:grid;gap:var(--gap-sm);grid-template-columns:1fr 1fr}
  .row{display:grid;gap:var(--gap);grid-template-columns:1fr 1fr 1fr}
  @media (max-width:980px){ .row{grid-template-columns:1fr 1fr} }
  @media (max-width:700px){ .row{grid-template-columns:1fr} }
  h1{margin:0;font-size:18px}
  .muted{color:var(--muted);font-size:12px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:var(--rad);padding:var(--pad)}
  .title{margin:0 0 6px 0;font-weight:700;font-size:14px}
  .btn{appearance:none;border:1px solid var(--border);background:rgba(255,255,255,.10);color:var(--txt);
       padding:8px 11px;border-radius:10px;cursor:pointer;font-weight:600}
  .btn:hover{background:rgba(255,255,255,.16)}
  .btn.primary{background:linear-gradient(to bottom right,#fecaca,#fcd34d);color:#111;border:none}
  .btn.sm{padding:6px 9px;border-radius:9px;font-size:13px}
  input,select,textarea{width:100%;background:rgba(0,0,0,.30);color:var(--txt);border:1px solid var(--border);
                        border-radius:10px;padding:8px 11px;outline:none;font-size:14px}
  .list{list-style:none;margin:0;padding:0;display:grid;gap:6px}
  .scroll{max-height:240px;overflow:auto;padding-right:4px;-webkit-overflow-scrolling:touch}
  .pill{display:inline-block;padding:3px 8px;border-radius:999px;background:rgba(255,255,255,.14);font-size:12px}
  .color-swatch{width:22px;height:22px;border-radius:6px;border:2px solid transparent;cursor:pointer}
  .color-swatch.active{border-color:#fff}
  .nota{white-space:pre-wrap; word-break:break-word; font-size:12px; margin-top:4px}
  .gearbar .btn{min-width:40px}

  /* Paleta en dos filas */
  #colorPalette{
    display:grid !important;
    grid-template-columns: repeat(7, 26px);
    grid-auto-rows: 26px;
    gap: 8px 10px;
  }
  @media (max-width:480px){
    #colorPalette{ grid-template-columns: repeat(5, 26px); }
  }
</style>
</head>
<body>
  <div class="container">
    <header>
      <h1>RoadFury</h1>
      <div class="flex" style="gap:12px">
        <div id="colorPalette" class="flex"></div>
        <label class="flex" style="font-size:13px;gap:6px">
          <input id="soundToggle" type="checkbox" style="width:auto" checked/>
          üîä Sonido
        </label>
      </div>
    </header>

    <div class="row">
      <!-- Columna 1: √Årbitro -->
      <section class="card grid">
        <div class="space">
          <h2 class="title">Modo √Årbitro y fases</h2>
          <label class="flex" style="font-size:13px">
            <input id="arbToggle" type="checkbox" checked style="width:auto"/> Activado
          </label>
        </div>
        <div class="grid-2">
          <label>Jugadores <input id="totalPlayers" type="number" min="1" value="6"/></label>
          <label>Posici√≥n <input id="position" type="number" min="1" value="3"/></label>
        </div>
        <div class="grid-2">
          <div>Mazo sugerido <div id="deckSuggested" class="pill" style="margin-top:4px">delanteros</div></div>
          <div>Fase: <b id="phaseLabel">reponer</b></div>
        </div>
        <div class="space">
          <div class="flex">
            <button id="nextPhaseBtn" class="btn sm">Siguiente fase</button>
            <button id="resetTurnBtn" class="btn sm">Reiniciar</button>
          </div>
        </div>
      </section>

      <!-- Columna 2: Jugador + Dados -->
      <section class="card grid" id="playerCard">
        <div class="space">
          <div class="flex" style="gap:10px">
            <img id="playerCarIcon" src="img/autos/trash.png" alt="car icon" style="max-width:100%; height:200px; object-fit:contain;border-radius:6px"/>
            <span id="carName" style="font-weight:700;font-size:16px">Trash</span>
            <span id="fcBadge" class="pill">OK</span>
          </div>
          <button id="fcBtn" class="btn sm">FC</button>
        </div>

        <div class="space">
          <h2 class="title">Marcha actual</h2>
          <div class="muted">Bonificador: <b id="bonifLabel">+0</b></div>
        </div>
        <div id="gearBtns" class="flex gearbar" style="flex-wrap:wrap"></div>

        <div class="grid" style="gap:12px">
          <div class="grid-2" style="align-items:start">
            <div class="grid">
              <div class="title">Lanzar 2d6 + bonif</div>
              <button id="roll2d6Btn" class="btn primary">Lanzar 2d6</button>
            </div>
            <div class="grid">
              <div class="space">
                <div class="title">Tiradas</div>
                <div class="flex">
                  <label class="flex" style="gap:6px">Dados
                    <select id="diceCount" style="width:70px">
                      <option value="1">1</option>
                      <option value="2" selected>2</option>
                      <option value="3">3</option>
                      <option value="4">4</option>
                    </select>
                  </label>
                  <button id="rollGenericBtn" class="btn sm">Tirar</button>
                </div>
              </div>
              <ul id="diceLog" class="list scroll"></ul>
            </div>
          </div>
        </div>
      </section>

      <!-- Columna 3: Poderes + Historial -->
      <div class="grid">
        <section class="card grid">
          <div class="space">
            <h2 class="title">Poderes</h2>
            <div class="flex">
              <button id="drawSuggestedBtn" class="btn sm">Robar ‚Äî sugerido</button>
              <button id="discardHandBtn" class="btn sm">Descartar</button>
            </div>
          </div>
          <div class="grid">
            <div class="title">En mano</div>
            <ul id="handList" class="list scroll"></ul>
          </div>
          <div class="grid">
            <div class="title">Activo</div>
            <ul id="activeList" class="list scroll"></ul>
          </div>
        </section>
        <section class="card">
          <h2 class="title">Historial</h2>
          <ul id="history" class="list scroll"></ul>
        </section>
      </div>
    </div>
  </div>

<script>
/* =============== Config general / utilidades =============== */
const ASSETS_VERSION = 'v8';
const asset = (p)=> `${p}?${ASSETS_VERSION}`;
function slug(s){
  return s.toString().normalize("NFD").replace(/[\u0300-\u036f]/g,"")
    .toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");
}

/* === Paleta de colores ‚Üí personajes (incluye motos) === */
const COLOR_OPTIONS = [
  "#0f172a","#1d4ed8","#047857","#facc15","#ffffff",
  "#581c87","#14532d","#7f1d1d","#312e81","#1f2937",
  "#4b5563","#22c55e","#e5e7eb"
];
const COLOR_TO_CAR_KEY = {
  "#0f172a":"trash","#1d4ed8":"pinion","#047857":"engine","#facc15":"oxide","#ffffff":"scorch",
  "#581c87":"spikes","#14532d":"rogue","#7f1d1d":"crusher","#312e81":"ashes","#1f2937":"fang",
  "#4b5563":"witch","#22c55e":"monstar","#e5e7eb":"paniga"
};
const CAR_LABEL = {
  trash:"Trash", pinion:"Pinion", engine:"Engine", oxide:"Oxide", scorch:"Scorch",
  spikes:"Spikes", rogue:"Rogue", crusher:"Crusher", ashes:"Ashes", fang:"Fang",
  witch:"Witch", monstar:"Monstar", paniga:"Paniga"
};
function renderPalette(sel){
  const pal=document.getElementById("colorPalette"); pal.innerHTML="";
  COLOR_OPTIONS.forEach(c=>{
    const b=document.createElement("button");
    b.className="color-swatch"+(c===sel?" active":"");
    b.style.background=c; b.onclick=()=>setTheme(c);
    pal.appendChild(b);
  });
}
function setTheme(c){
  document.body.style.background = `linear-gradient(to bottom, ${c}, #000)`;
  state.color=c;
  const key=COLOR_TO_CAR_KEY[c]||"trash";
  const label=CAR_LABEL[key]||"Car";
  document.getElementById("playerCarIcon").src=asset(`img/autos/${key}.png`);
  document.getElementById("carName").textContent=label;
  renderPalette(c);
}

/* =============== Estado =============== */
const bonifs={1:0,2:1,3:2,4:3,5:4,6:5};
const state={marcha:1,fc:false,jugadoresTotal:6,posicionActual:3,fase:"reponer",
             modoArbitro:true,mano:[],activos:[],diceCount:2,diceLog:[],hist:[],color:"#7f1d1d"};

/* =============== Render (simplificado) =============== */
const el=id=>document.getElementById(id);
function renderPlayer(){
  el("fcBadge").textContent=state.fc?"FC":"OK";
  el("bonifLabel").textContent=(bonifs[state.marcha]>=0?"+":"")+bonifs[state.marcha];
  const wrap=el("gearBtns"); wrap.innerHTML="";
  [1,2,3,4,5,6].forEach(g=>{
    const b=document.createElement("button");
    b.textContent=g+"¬™"; b.className="btn sm";
    if(state.marcha===g){ b.style.background="#fff"; b.style.color="#111"; }
    b.onclick=()=>{state.marcha=g; renderPlayer();};
    wrap.appendChild(b);
  });
}
function renderHistory(){el("history").innerHTML=state.hist.map(h=>`<li>${h}</li>`).join("");}
function renderDiceLog(){el("diceLog").innerHTML=state.diceLog.map(h=>`<li>${h}</li>`).join("");}
function pushHist(m){state.hist.unshift(m);renderHistory();}
function pushDice(m){state.diceLog.unshift(m);renderDiceLog();}
function rollDie(s){return 1+Math.floor(Math.random()*s);}

document.getElementById("roll2d6Btn").onclick=()=>{
  const d1=rollDie(6), d2=rollDie(6), total=d1+d2+bonifs[state.marcha];
  pushHist(`2d6: ${d1}+${d2}+${bonifs[state.marcha]} = ${total}`);
  pushDice(`Movimiento: ${total}`);
};
document.getElementById("rollGenericBtn").onclick=()=>{
  const n=state.diceCount, vals=Array.from({length:n},()=>rollDie(6));
  pushHist(`${n}d6: ${vals.join("+")}`);
  pushDice(`${n}d6: ${vals.reduce((a,b)=>a+b,0)}`);
};
document.getElementById("diceCount").onchange=()=>{state.diceCount=+el("diceCount").value;};

function renderAll(){renderPalette(state.color);renderPlayer();renderHistory();renderDiceLog();}
renderAll();
</script>
</body>
</html>
